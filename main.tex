% This file should be compiled with XeLaTeX.

\documentclass[openany]{memoir}

% Font
\usepackage{fontspec}
\setmainfont{Junicode}[
	Extension=.ttf,
	BoldFont=*-Bold,
	ItalicFont=*-Italic]

% Underline that does not skip descender
% Should be called \nsunderline

% Packages
\usepackage{xparse}
\usepackage{geometry} %For margins.
\usepackage{longtable} %Long tables.

% Formatting
\usepackage{reledmac}

% Headers
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhead[OR,EL]{\thepage}
\fancyhead[EC]{The Great Edda}
\fancyhead[OC]{\booktitle}

% Define verse counters
\newcounter{versea}
\newcounter{verseb}

\begin{document}

% Book and chapter commands
	\NewDocumentCommand{\chapterStart}{o O{Chap}}{% Command at the start of chapter
		\setcounter{versea}{0}%
		\setcounter{verseb}{0}%
		\stepcounter{chapter}%
		\IfNoValueF{#1}{%
			\begin{center}%
			\textbf{#2. \arabic{chapter}} \\
			{#1}\end{center}%
		}%
	}

	\NewDocumentCommand{\bookStart}{m}{% Command at the start of book
	  \book{#1}
		\def\booktitle{#1}
		\setcounter{chapter}{0} % Set chapter count to zero.
		\chapterStart{}%
	}

% Verse format commands
	\NewDocumentCommand{\bvg}{o}{% Begin verse group
		\begin{ledgroup}%
		\beginnumbering%
	}

	\NewDocumentCommand{\bva}{o}{% Begin verse a
		\begin{large}\begin{stanza}% Begin stanza
		\IfNoValueTF{#1}{% Add verse number according to counter
			\stepcounter{versea}% Step verse counter
			\flagstanza{\textbf{\arabic{versea}}}
		}{% Add verse number specified as optional argument
			\flagstanza{\textbf{#1}}
		}
	}
	\NewDocumentCommand{\eva}{o}{% End verse a
		\& \end{stanza}\end{large}\endnumbering% End reledmac numbering and stanza
		\vspace{1.5mm}% Vertical space
	}

	\NewDocumentCommand{\bvb}{o}{% Begin verse b
		\stepcounter{verseb}%
		\IfNoValueT{#1}{%
			\textbf{\arabic{verseb} }%
		}%
	}
	\NewDocumentCommand{\evb}{o}{% End verse b
		% Nothing (for now)
	}

	\NewDocumentCommand{\evg}{o}{% End verse group
		\end{ledgroup}%
		\vspace{1cm}%
	}

% Note formatting
	% Side note margin
	\setlength{\ledlsnotesep}{2 \ledlsnotesep}

	% Make A foot notes paragraphs
	\Xarrangement[A]{paragraph}

% Poem formatting
	% First line number at 3
	\firstlinenum{2}
	\linenumincrement{2}

	% Stanza indentation (required for \astanza to work)
	\setstanzaindents{5, 2, 2}
	\setcounter{stanzaindentsrepetition}{2}

	% Mark cæsura.
	\newcommand{\hld}{\hspace{5mm} }%\leavevmode\unskip\quad\ignorespaces}

	% Indent lines (in Ljóðaháttr or Galdralag).
	\newcommand{\ind}{%
		\hspace{1.5em}%
	}

	% Mark alliteration. This might not be present in the final version.
	\NewDocumentCommand{\alst}{m}{%
		\underline{#1}%
	}

	% Mark kennings.
	\NewDocumentCommand{\ken}{m o}{%
		\IfNoValueTF{#2}{% Not proper noun
			\textsc{[{#1}]}% [STONE]
		}{% Proper noun
			{[= {#1}]}% [= Wooden]
		}%
	}

% Index link command
%	{#1}\textsuperscript{†}%	Dagger at the end
%	\nsunderline{#1}%	Underline

	\NewDocumentCommand{\inx}{m}{%
		{#1}%\textsuperscript{†}%
	}

% Sigla
	% Authors
	\newcommand{\Finnur}{%
		Finnur%
	}
	\newcommand{\Snorri}{%
		Snorri%
	}
	\newcommand{\CV}{%
		Cleasby-Vigfússon%
	}
	\newcommand{\Skp}{% Skaldic Poetry of the Scandinavian Middle Ages
		\emph{Skp}%
	}

	%Modern books
	\newcommand{\FaulkesEdda}{%
		\emph{SnE} 2005%
	}

	% Manuscripts
	\newcommand{\Regius}{% Codex Regius (of the poetic edda)
		\emph{R}%
	}
	\newcommand{\AM}{% AM 748 I a 4to
		\emph{A}%
	}
	\newcommand{\Hauksbok}{% Hauksbok
		\emph{H}%
	}
	\newcommand{\GylfMS}{% For referring to Gylfaginning manuscripts when verses are attested there.
		\emph{G}%
	}
	\newcommand{\RegiusProse}{% Codex Regius of the Prose Edda
		\emph{S}%
	}
	\newcommand{\Trajectinus}{% Codex Trajectinus
		\emph{T}%
	}
	\newcommand{\Wormianus}{% Codex Wormianus
		\emph{W}%
	}
	\newcommand{\Upsaliensis}{% Codex Upsaliensis
		\emph{U}%
	}
	\newcommand{\HildMS}{% For referring to the Hildebrandslied manuscript.
		\emph{ms.}%
	}
	\newcommand{\Hickes}{% George Hickes
		\emph{Hickes}%
	}

	% Texts
	\newcommand{\Hildebrandslied}{% Speeches of Hildbrand
		\emph{Hild}%
	}
	\newcommand{\Beowulf}{% Beewolf
		\emph{Bee}%
	}
	\newcommand{\Ynglingatal}{% Tally of the Inglings
		\emph{Ing}%
	}
	\newcommand{\Hervarar}{% Saw of Harware
		\emph{HarS}%
	}
	\newcommand{\Gylfaginning}{% For referring to Gylfaginning as a text
		\emph{Yilf}% F
	}
	\newcommand{\Haleygjatal}{% Tally of the Hallowlendings
		\emph{Hal}%
	}
	\newcommand{\Rigsthula}{% Thule of Righ
		\emph{Righ}%
	}
	\newcommand{\Vafthrudnismal}{% Speeches of Webthrithner
		\emph{Web}%
	}
	\newcommand{\FraLoka}{% From Lock
		\emph{FrL}%
	}

% Books

% Introduction, bibliography and abbreviations
% \include{intro.tex}

% Theology, mythology, independent order
%	\include{books/01 Spae of the Wallow.tex}% — Weden
%	\include{books/02 Speeches of Webthrithner.tex}% — Weden
%	\include{books/03 Speeches of the High One.tex}% — Weden
%	\include{books/04 From the Sons of king Reeding.tex}% — Weden
%	\include{books/05 Speeches of Grimner.tex}% — Weden
%	\include{books/The Thule of Righ.tex}% — Weden
%	\include{books/Leed of Hoarbeard.tex}% — Weden, Thunder
	\include{books/Lay of Hymer.tex}% — Thunder, Tue
%	\include{books/Lay of Thrim.tex}% — Thunder
%	\include{books/Leed of Hindle.tex}% — Frow

% Heroic poems, in order of the Codex Regius
% \include{books/Lay of Wayland.tex}% — Heroic/mythological, transition
%	\include{books/First Lay of Hallow Hundingsbane.tex}
%	\include{books/Second lay of Hallow Hundingsbane.tex}
%	\include{books/Lay of Hallow Harwardson.tex}
%	\include{books/Lay of Attle.tex}
%	\include{books/Third Lay of Guthrun.tex}
%	\include{books/Speeches of Sighdrive.tex}

% Additional heroic poems
%	\include{books/Speeches of Hildbrand.tex}
%	\include{books/Fight at Finnsbury.tex}
%	\include{books/Beewolf.tex} — Probably not happening.
\end{document}
