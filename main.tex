% This file should be compiled with XeLaTeX.

\documentclass[openany]{memoir}

% Font
\usepackage{fontspec}
\setmainfont{Junicode}[
	Extension=.ttf,
	BoldFont=*-Bold,
	ItalicFont=*-Italic]

% Underline that does not skip descender
% Should be called \nsunderline
 
% Packages
\usepackage{xparse}
\usepackage{geometry} %For margins.

% Formatting
\usepackage{reledmac}

% Define verse counters
\newcounter{versea}
\newcounter{verseb}

\begin{document}

% Book and chapter commands
	\NewDocumentCommand{\chapterStart}{o O{Chap}}{% Command at the start of chapter
		\setcounter{versea}{0}%
		\setcounter{verseb}{0}%
		\stepcounter{chapter}%
		\IfNoValueF{#1}{%
			\begin{center}%
			\textbf{#2. \arabic{chapter}} \\
			{#1}\end{center}%
		}%
	}

	\newcommand{\bookStart}{% Command at the start of book
		\setcounter{chapter}{0} % Set chapter count to zero.
		\chapterStart{}%
	}

% Verse format commands
	\NewDocumentCommand{\bvg}{o}{% Begin verse group
		\begin{minipage}{1\textwidth}%
		\beginnumbering%
	}

	\NewDocumentCommand{\bva}{o}{% Begin verse a
		\stepcounter{versea}%
		\begin{stanza}% Begin stanza
		\IfNoValueF{#1}{%
		\ifnum\value{versea}>1% If it is the first verse, we do not show it.
			\textbf{\arabic{versea}} \fi % Styling. The verse is just the number in superscript. 
		}{%
			\textbf{\arabic{versea}} %
		}%
	}
	\NewDocumentCommand{\eva}{o}{% End verse a
		\& \end{stanza}\endnumbering\vspace{1.5mm}% End reledmac numbering and stanza
	}
	
	\NewDocumentCommand{\bvb}{o}{% Begin verse b
		\stepcounter{verseb}%
		\IfNoValueF{#1}{%
		\ifnum\value{verseb}>1% If it is the first verse, we do not show it.
			\textbf{\arabic{verseb}} \fi % Styling. The verse is just the number in superscript. 
		}{%
			\textbf{\arabic{verseb}} %
		}%
	}
	\NewDocumentCommand{\evb}{o}{% End verse b
		% Nothing (for now)
	}
	
	\NewDocumentCommand{\evg}{o}{% End verse group
		\end{minipage}%
		\vspace{1cm}%
	}
	
% Poem formatting
	% First line number at 5
	\firstlinenum{1}
	\linenumincrement{2}
	
	% Stanza indentation (required for \astanza to work)
	\setstanzaindents{5, 2, 2}
	\setcounter{stanzaindentsrepetition}{2}

	% Mark cæsura.
	\newcommand{\hld}{\hspace{5mm} }%\leavevmode\unskip\quad\ignorespaces}

	% Indent lines (in Ljóðaháttr or Galdralag).
	\newcommand{\ind}{%
		\hspace{1.5em}%
	}

	% Mark alliteration. This might not be present in the final version.
	\NewDocumentCommand{\alst}{m}{%
		\underline{#1}%
	}

% Index link command
%	{#1}\textsuperscript{†}%	Dagger at the end
%	\nsunderline{#1}%	Underline

	\NewDocumentCommand{\inx}{m}{%
		{#1}\textsuperscript{†}%
	}

% Sigla
	% Authors
	\newcommand{\Finnur}{%
		Finnur%
	}
	\newcommand{\Snorri}{%
		Snorri%
	}
	\newcommand{\CV}{%
		Cleasby-Vigfússon%
	}
	
	% Manuscripts
	\newcommand{\Regius}{%
		\emph{R}%
	}
	\newcommand{\Hauksbok}{%
		\emph{H}%
	}
	
	% Texts
	\newcommand{\Ynglingatal}{%
		\emph{Ing}%
	}
	\newcommand{\Hervarar}{%
		\emph{HarS}%
	}
	\newcommand{\Gylfaginning}{%
		\emph{Yilf}%
	}
	\newcommand{\Haleygjatal}{%
		\emph{Hal}% Reckoning of the Hallowlendings
	}
	\newcommand{\Rigsthula}{%
		\emph{Righ}%
	}
	\newcommand{\Vafthrudnismal}{%
		\emph{Web}%
	}

% Books
	\include{books/01 Spae of the Wallow.tex}

\end{document}
